{"version":3,"sources":["sandstorm.js"],"names":[],"mappings":"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","file":"sandstorm-compiled.js","sourcesContent":["/**\n * Created by josh on 25/07/2016.\n */\n\ndocument.addEventListener(\"DOMContentLoaded\", init, false);\n\nvar sandstorm = null;\nvar serviceAPI = null;\n\nfunction init(){\n    serviceAPI = new ServiceAPI();\n    sandstorm = new Sandstorm(document.getElementById(\"canvas\"));\n\n    console.log(\"fetching dominate colours\");\n\n    var clusters = getQueryStringParameterByName(\"clusters\");\n    if(clusters == null || clusters.length == 0){\n        clusters = \"-1\";\n    }\n\n    serviceAPI.dominatecolours(clusters, function(api, result){\n        console.log(\"fetched dominate colours\");\n\n        // set colour set\n        if(result != null){\n            var colourClusters = result[\"colour_clusters\"];\n            for(var i=0; i<colourClusters.length; i++){\n                var r = colourClusters[i][\"colour\"][0];\n                var g = colourClusters[i][\"colour\"][1];\n                var b = colourClusters[i][\"colour\"][2];\n                var colour = new Vec3(r, g, b);\n                sandstorm.colourSet.push(colour);\n            }\n        }\n\n        sandstorm.start();\n    });\n}\n\nfunction randomF(min, max){\n    return (Math.random() * (max-min)) + min;\n}\n\nfunction randomI(min, max){\n    return Math.floor((Math.random() * (max-min)) + min);\n}\n\nfunction constrain(val, min, max){\n    return Math.min(Math.max(val, min), max);\n}\n\nfunction mapRange(value, low1, high1, low2, high2) {\n    return low2 + (high2 - low2) * (value - low1) / (high1 - low1);\n}\n\nclass Vec3{\n\n    constructor(x=0, y=0, z=0){\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n\n    set(x, y, z){\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n\n    copy(other){\n        this.x = other.x;\n        this.y = other.y;\n        this.z = other.z;\n    }\n\n    createCopy(){\n        return new Vec3(this.x, this.y, this.z);\n    }\n\n    get colourStyle(){\n        return \"rgb(\" + Math.floor(this.x) + \", \" + Math.floor(this.y) + \", \" + Math.floor(this.z) + \")\";\n    }\n\n    static lerp(source, target, t){\n        var dx = source.x - target.x;\n        var dy = source.y - target.y;\n        var dz = source.z - target.z;\n\n        return new Vec3(source.x + t * dx, source.y + t * dy, source.z + t * dz);\n    }\n}\n\nclass Vec2{\n\n    constructor(x=0, y=0){\n        this.x = x;\n        this.y = y;\n    }\n\n    add(other){\n        this.x += other.x;\n        this.y += other.y;\n    }\n\n    mul(s){\n        this.x *= s;\n        this.y *= s;\n    }\n\n    set(x, y){\n        this.x = x;\n        this.y = y;\n    }\n\n    normalize(){\n        var length = this.length;\n\n        if(length == 0){\n            this.x = 0;\n            this.y = 0;\n        } else{\n            this.x /= length;\n            this.y /= length;\n        }\n    }\n\n    get length(){\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n\n    copy(other){\n        this.x = other.x;\n        this.y = other.y;\n    }\n\n    createCopy(){\n        return new Vec2(this.x, this.y);\n    }\n\n    static distance (v1, v2) {\n        var dx = v1.x - v2.x;\n        var dy = v1.y - v2.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    static add(v1, v2){\n        return new Vec2(v1.x + v2.x, v1.y + v2.y);\n    }\n\n    static sub(v1, v2){\n        return new Vec2(v1.x - v2.x, v1.y - v2.y);\n    }\n\n    static mul(v1, v2){\n        return new Vec2(v1.x * v2.x, v1.y * v2.y);\n    }\n\n    static lerp(sv, tv, t){\n        var dx = sv.x - tv.x;\n        var dy = sv.y - tv.y;\n\n        return new Vec2(sv.x + t * dx, sv.y + t * dy);\n    }\n}\n\nclass Grain{\n\n    constructor(gusts=null, colourSet=null, canvasWidth=0, canvasHeight=0){\n        this.position = new Vec2();\n        this.oldPosition = new Vec2();\n        this.velocity = new Vec2();\n        this.radius = 1;\n        this.colour = new Vec3();\n        this.damping = 0.3;\n\n        this.gusts = gusts;\n        this.canvasWidth = canvasWidth;\n        this.canvasHeight = canvasHeight;\n\n        this.colourSet = colourSet;\n\n        this.recycle();\n    }\n\n    recycle(){\n        this.position.set(randomI(0, this.canvasWidth), randomI(-this.canvasHeight, 0));\n        this.oldPosition.copy(this.position);\n\n        this.velocity.set(randomF(-0.02, 0.02), randomF(0.4, 1.8));\n        this.radius = randomF(0.25, 2.0);\n\n        var sectionWidth = this.canvasWidth / this.colourSet.length;\n        var a = ((this.position.x / this.canvasWidth) * sectionWidth)/sectionWidth;\n        var setNumber = Math.floor((this.position.x / this.canvasWidth) * this.colourSet.length);\n\n        // var colourSteps = Math.ceil(this.colourSet.length / 3.0) - 1;\n        // var setWidth = 1.0 * this.canvasWidth/colourSteps;\n        // var setNumber = Math.floor(this.position.x/setWidth);\n        //var a = (this.position.x - (setNumber * setWidth))/setWidth;\n\n        // this.colour = this.colourSet[setNumber].createCopy();\n\n        var nextSetNumber = setNumber + 1;\n        if(nextSetNumber >= this.colourSet.length){\n            nextSetNumber = 0;\n        }\n\n        this.colour = Vec3.lerp(this.colourSet[setNumber], this.colourSet[nextSetNumber], a);\n        this.colour = this.colourSet[setNumber].createCopy();\n\n        this.colour.x = constrain(this.colour.x + randomI(-10, 10), 0, 255);\n        this.colour.y = constrain(this.colour.y + randomI(-10, 10), 0, 255);\n        this.colour.z = constrain(this.colour.z + randomI(-10, 10), 0, 255);\n\n        //console.log(this.colour.colourStyle);\n    }\n\n    update(et){\n        this.oldPosition.copy(this.position);\n\n        this.velocity.mul(this.damping);\n\n        var totalWind = new Vec2(0, randomF(1.5, 2.0));\n\n        if(this.gusts != null){\n            for(var i=0; i<this.gusts.length; i++){\n                var gust = this.gusts[i];\n                var gustForce = gust.getForceAt(this.position);\n                totalWind.x += gustForce.x;\n                totalWind.y += gustForce.y;\n            }\n        }\n\n        this.velocity.add(totalWind);\n\n        this.position.add(this.velocity);\n\n        if(this.position.y > this.canvasHeight){\n            this.recycle();\n        }\n    }\n    \n    render(canvas, ctx){\n        ctx.save();\n\n        ctx.beginPath();\n        ctx.lineWidth=this.radius;\n        ctx.strokeStyle = this.colour.colourStyle;\n        ctx.moveTo(this.oldPosition.x, this.oldPosition.y);\n        ctx.lineTo(this.position.x, this.position.y);\n        ctx.stroke();\n\n        ctx.restore();\n    }\n}\n\nclass Wind{\n\n    constructor(canvasWidth, canvasHeight){\n        this.position = new Vec2(randomI(50, canvasWidth-50), randomI(50, canvasHeight-50));\n\n        this.canvasWidth = canvasWidth;\n        this.canvasHeight = canvasHeight;\n        this.velocity = new Vec2(randomF(-1.0, 1.0), randomF(-1.0, 1.0));\n        //this.force = new Vec2(randomF(-3.0, 3.0), randomF(-1.0, 1.0));\n        this.radius = randomI(50, 250);\n        this.strength = randomF(-10.0, 10.0);\n    }\n\n    update(et){\n        this.position.add(this.velocity);\n        if(this.position.x < 0 || this.position.x >= this.canvasWidth){\n            this.velocity.x = -this.velocity.x;\n            this.position.x += 2 * this.velocity.x;\n        }\n\n        if(this.position.y < 0 || this.position.y >= this.canvasHeight){\n            this.velocity.y = -this.velocity.y;\n            this.position.y += 2 * this.velocity.y;\n        }\n    }\n\n    getForceAt(position){\n        var forceHere = new Vec2(0,0);\n\n        var distance = Vec2.distance(this.position, position);\n        if(distance > this.radius){\n            return forceHere;\n        }\n\n        //function mapRange(value, low1, high1, low2, high2)\n        var force = mapRange(distance, 0, this.radius, this.strength, 0);\n        var dPoint = new Vec2(position.x - this.position.x, position.y - this.position.y);\n        var forceDirection = new Vec2(dPoint.y, -dPoint.x);\n        forceDirection.normalize();\n        forceDirection.mul(force);\n        forceHere.add(forceDirection);\n\n        return forceHere;\n    }\n}\n\nclass Sandstorm{\n\n    constructor(canvas){\n        this.canvas = canvas;\n        this.context = this.canvas.getContext(\"2d\");\n        this.running = false;\n        this.startTimestamp = 0;\n        this.lastUpdateTimestamp = 0;\n\n        this.onAnimationFrame = this.onAnimationFrame.bind(this);\n        this.onResize = this.onResize.bind(this);\n        this.onOrientationChange = this.onOrientationChange.bind(this);\n\n        window.addEventListener(\"resize\", this.onResize);\n        window.addEventListener(\"orientationchange\", this.onOrientationChange);\n\n        this.gusts = new Array();\n        this.grains = new Array();\n        this.colourSet = new Array();\n\n        this.numberOfGusts = 8;\n        this.numberOfGrains = 5000;\n\n        this.onResize();\n    }\n\n    start(){\n        if(this.running){\n            return;\n        }\n\n        this.startTimestamp = Date.now();\n\n        console.log(\"starting Sandstorm\");\n\n        this.initScene();\n        \n        this.lastUpdateTimestamp = Date.now();\n        this.running = true;\n\n        window.requestAnimationFrame(this.onAnimationFrame);\n    }\n\n    stop(){\n        this.running = false;\n    }\n\n    initScene(){\n        console.log(\"initScene\");\n\n        this.clearCanvas();\n\n        this.gusts = new Array();\n        this.grains = new Array();\n\n        for(var i=0; i<this.numberOfGusts; i++){\n            this.gusts.push(new Wind(this.canvas.width, this.canvas.height));\n        }\n\n        for(var i=0; i<this.numberOfGrains; i++){\n            this.grains.push(\n                new Grain(this.gusts, this.colourSet, this.canvas.width, this.canvas.height)\n            );\n        }\n    }\n\n    onAnimationFrame(){\n        if(!this.running){\n            return;\n        }\n\n        var elapsedTime = Date.now() - this.lastUpdateTimestamp;\n        this.lastUpdateTimestamp = Date.now();\n\n        elapsedTime /= 1000; // elapsedTime in ms\n\n        this.onUpdate(elapsedTime);\n        this.onRender();\n\n        window.requestAnimationFrame(this.onAnimationFrame);\n    }\n\n    onUpdate(et){\n        // update gusts\n        this.gusts.forEach(function(element, index, array){\n            element.update(et);\n        });\n\n        this.grains.forEach(function(element, index, array){\n            element.update(et);\n        });\n    }\n\n    clearCanvas(){\n        this.context.fillStyle = \"#FFFFFF\";\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    onRender(){\n        var canvas = this.canvas; \n        var context = this.context;\n\n        // this.clearCanvas();\n\n        this.grains.forEach(function(element, index, array){\n            element.render(canvas, context);\n        });\n\n        // this.gusts.forEach(function(element, index, array){\n        //     context.beginPath();\n        //     context.fillStyle = \"blue\";\n        //     context.arc(element.position.x, element.position.y, element.radius,  0, Math.PI * 2, true);\n        //     context.fill();\n        //\n        // });\n\n        this.drawPalette(canvas, context);\n    }\n\n    drawPalette(canvas, context){\n        var width = Math.min(canvas.width, canvas.height) * 0.05;\n        var padding = width * 0.05;\n        var x = canvas.width - ((width + padding) * (this.colourSet.length + 1));\n        var y = canvas.height - width - padding;\n\n        for(var i=0; i<this.colourSet.length; i++){\n            context.fillStyle = this.colourSet[i].colourStyle;\n            context.fillRect(x, y, width, width);\n            x += (width + padding);\n        }\n\n    }\n\n    onOrientationChange(){\n        this.onResize();\n    }\n\n    onResize(){\n        this.canvas.width = document.width | document.body.clientWidth;\n        this.canvas.height = document.height | document.body.clientHeight;\n\n        if(this.running){\n            this.initScene(); // reset scene\n        }\n    }\n}\n\nclass ServiceAPI{\n\n    constructor(){\n        this._rootUrl = \"http://instacolour.herokuapp.com\";\n        this._busy = false;\n    }\n\n    get isBusy(){\n        return this._busy;\n    }\n\n    dominatecolours(clusters, handler){\n        this._busy = true;\n\n        var _this = this;\n\n        var xhr = new XMLHttpRequest();\n        xhr.onload = function(e) {\n            _this._busy = false;\n            var jsonObj = JSON.parse(xhr.response)\n            if(handler != null){\n                handler(_this, jsonObj);\n            }\n        }\n        xhr.onerror = function(e){\n            _this._busy = false;\n            if(handler != null) {\n                handler(_this, null);\n            }\n        }\n\n        console.log(\"calling \" + this._rootUrl + \"/api/dominatecolours?clusters=\" + clusters);\n\n        xhr.open(\"GET\", this._rootUrl + \"/api/dominatecolours?clusters=\" + clusters, true);\n        xhr.send();\n    }\n}\n\nfunction getQueryStringParameterByName(name, url) {\n    if (!url) url = window.location.href;\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n    var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n        results = regex.exec(url);\n    if (!results) return null;\n    if (!results[2]) return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}"]}