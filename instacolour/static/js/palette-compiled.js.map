{"version":3,"sources":["palette.js"],"names":[],"mappings":"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","file":"palette-compiled.js","sourcesContent":["/**\n * Created by josh on 11/07/2016.\n */\n\nvar canvas = null;\nvar context = null;\n\nvar bgCanvas = null;\nvar bgContext = null;\n\nvar srcImageData = null;\nvar dstImageData = null;\n\nvar fading = false;\n\ndocument.addEventListener(\"DOMContentLoaded\", init, false);\n\nfunction init(){\n    canvas = document.getElementById(\"target-image-canvas\");\n    context = canvas.getContext(\"2d\");\n\n    bgCanvas = document.getElementById(\"bg-target-image-canvas\");\n    bgContext = bgCanvas.getContext(\"2d\");\n\n    document.getElementById(\"url-input\").addEventListener(\"keydown\", function(evt){\n        if(evt.keyCode == 13){\n            analyseImage(document.getElementById(\"url-input\").value, document.getElementById(\"colours\").value);\n        }\n    });\n\n    document.getElementById(\"colours\").addEventListener(\"keydown\", function(evt){\n        if(evt.keyCode == 13){\n            analyseImage(document.getElementById(\"url-input\").value, document.getElementById(\"colours\").value);\n        }\n    });\n\n    analyseImage(document.getElementById(\"url-input\").value, document.getElementById(\"colours\").value);\n}\n\nfunction colouriseImage(swatchIndex) {\n    // var serviceURL = \"https://instacolour.herokuapp.com/api/colourise\";\n    //\n    // var packet = \"image_url=\" + url;\n    // packet += \"&colours=\" + colours;\n    // packet += \"&swatch_index=\" + swatchIndex;\n    //\n    // var xhr = new XMLHttpRequest();\n    // xhr.onload = function(e) {\n    //\n    // }\n    //\n    // xhr.open(\"POST\", serviceURL, true);\n    // xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n    // xhr.send(packet);\n\n    var url = document.getElementById(\"url-input\").value;\n    var colours = document.getElementById(\"colours\").value;\n\n    var imageUrl = \"https://instacolour.herokuapp.com/api/colourise?image_url=\" + url;\n    imageUrl += \"&colours=\" + colours;\n    imageUrl += \"&swatch_index=\" + swatchIndex;\n\n    console.log(\"requesting \" + imageUrl);\n\n    loadImage(imageUrl, false);\n}\n\nfunction loadImage(url, fade=false, callbackFunc=null){\n    var image = new Image();\n    image.onload = function(e) {\n        var h = 400;\n        var w = (400/image.height * image.width);\n\n        if(fade){\n            bgCanvas.height = h;\n            bgCanvas.width = w;\n            bgContext.drawImage(image, 0, 0, w, h);\n            fading = true;\n            srcImageData = context.getImageData(0, 0, w, h);\n            dstImageData = bgContext.getImageData(0, 0, w, h);\n\n            console.log(\"fading into image\");\n\n            startFading();\n        } else{\n            canvas.height = h;\n            canvas.width = w;\n            context.drawImage(image, 0, 0, w, h);\n        }\n\n        if(callbackFunc != null){\n            callbackFunc();\n        }\n    }\n    image.onerror = function(){\n        if(callbackFunc != null){\n            callbackFunc();\n        }\n    }\n    image.src = url;\n    // image.crossOrigin = \"anonymous\";\n}\n\nfunction startFading(){\n\n    var maxDiff = 0;\n\n    for(var i=0; i<srcImageData.data.length; i++){\n        srcImageData[i] +=  (dstImageData[i] - srcImageData[i]) * 0.3;\n        var diff = (dstImageData[i].data - srcImageData[i].data);\n        if(diff > maxDiff)\n            maxDiff = diff;\n    }\n\n    context.putImageData(srcImageData, 0, 0);\n\n    if(maxDiff < 5){\n        srcImageData = null;\n        dstImageData = null;\n        fading = false;\n    }\n\n    if(fading) {\n        window.requestAnimationFrame(startFading);\n    }\n}\n\nfunction analyseImage(url, colours) {\n    var colorsElem = document.getElementById(\"colors\");\n    while (colorsElem.firstChild) {\n        colorsElem.removeChild(colorsElem.firstChild);\n    }\n\n    var swatchesElem = document.getElementById(\"swatches\");\n    while (swatchesElem.firstChild) {\n        swatchesElem.removeChild(swatchesElem.firstChild);\n    }\n\n    loadImage(url, false);\n\n\n    var packet = \"image_url=\" + url;\n    packet += \"&colours=\" + colours;\n\n    var serviceURL = \"https://instacolour.herokuapp.com/api/vibrantcolours\";\n\n    var xhr = new XMLHttpRequest();\n    xhr.onload = function(e) {\n        console.log(xhr.response);\n        if(xhr.response != null){\n            var jsonObj = JSON.parse(xhr.response)\n\n            if(jsonObj.hasOwnProperty(\"palette\")){\n                var palettes = jsonObj[\"palette\"];\n\n                if(palettes.hasOwnProperty(\"swatches\")){\n                    var swatches = palettes[\"swatches\"];\n                    for(var i=0; i<swatches.length; i++){\n                        var swatch = swatches[i];\n                        if(swatch.hasOwnProperty(\"rgb\")){\n                            var rgb = createRGBValue(swatch[\"rgb\"]);\n                            var elem = addColourSwatch(rgb, i);\n\n                            // add click listener\n                            elem.dataset[\"index\"] = i;\n                            elem.name = i;\n                            elem.addEventListener('click', function(e){\n                                colouriseImage(e.target.dataset.index);\n                            });\n                        }\n                    }\n                }\n\n                if(palettes.hasOwnProperty(\"vibrant_swatch\")){\n                    var rgb = createRGBValue(palettes[\"vibrant_swatch\"]);\n                    addColourElement(\"Vibrant\", rgb);\n                }\n\n                if(palettes.hasOwnProperty(\"light_vibrant_swatch\")){\n                    var rgb = createRGBValue(palettes[\"light_vibrant_swatch\"]);\n                    addColourElement(\"Light Vibrant\", rgb);\n                }\n\n                if(palettes.hasOwnProperty(\"dark_vibrant_swatch\")){\n                    var rgb = createRGBValue(palettes[\"dark_vibrant_swatch\"]);\n                    addColourElement(\"Dark Vibrant\", rgb);\n                }\n\n                if(palettes.hasOwnProperty(\"muted_swatch\")){\n                    var rgb = createRGBValue(palettes[\"muted_swatch\"]);\n                    addColourElement(\"Muted\", rgb);\n                }\n\n                if(palettes.hasOwnProperty(\"light_muted_swatch\")){\n                    var rgb = createRGBValue(palettes[\"light_muted_swatch\"]);\n                    addColourElement(\"Light Muted\", rgb);\n                }\n\n                if(palettes.hasOwnProperty(\"dark_muted_swatch\")){\n                    var rgb = createRGBValue(palettes[\"dark_muted_swatch\"]);\n                    addColourElement(\"Dark Muted\", rgb);\n                }\n            }\n        }\n    }\n\n    xhr.open(\"POST\", serviceURL, true);\n    xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n    xhr.send(packet);\n}\n\nfunction createRGBValue(swatchColour){\n    return \"rgb(\" + swatchColour[0] + \",\" + swatchColour[1] + \",\" + swatchColour[2] + \")\";\n}\n\nfunction addColourSwatch(rgb, i){\n    var parentDiv = document.createElement(\"div\");\n    var div = document.createElement(\"div\");\n    div.className = \"colorswatch shadow-z-1\";\n    div.dataset.index = i;\n    div.style[\"background-color\"] = rgb;\n    parentDiv.appendChild(div);\n    document.getElementById(\"swatches\").appendChild(parentDiv);\n\n    return parentDiv;\n}\n\nfunction addColourElement(text, rgb){\n    /*\n    <div><div class=\"color shadow-z-1\" style=\"background-color: rgb(191, 216, 84);\"></div><span>Vibrant</span></div><div>\n     */\n    var parentDiv = document.createElement(\"div\");\n    var div = document.createElement(\"div\");\n    div.className = \"color shadow-z-1\";\n    div.style[\"background-color\"] = rgb;\n    parentDiv.appendChild(div);\n    var span = document.createElement(\"span\");\n    span.innerText = text;\n    parentDiv.appendChild(span);\n    document.getElementById(\"colors\").appendChild(parentDiv);\n}\n\nfunction getColourFromJSONObject(obj){\n    return \"rgb(\" + obj[\"colour\"][0] + \", \" + obj[\"colour\"][1] + \", \" + obj[\"colour\"][2] + \")\";\n}\n\nfunction getQueryStringParameterByName(name, url) {\n    if (!url) url = window.location.href;\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n    var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n        results = regex.exec(url);\n    if (!results) return null;\n    if (!results[2]) return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}"]}